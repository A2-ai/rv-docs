---
title: "Difference with renv"
description: "Describing the shortcomings of renv and differences rv has"
---

import { Steps } from '@astrojs/starlight/components';

`renv` is the most popular R package manager in the R ecosystem.
It helps you ["create reproducible environments for your R projects"](https://rstudio.github.io/renv/articles/renv.html).

But `renv` is not without its issues, many of which lead to the decision to create `rv`. To fully grasp these issues, 
we need a bit of `renv` background.

## `renv`

In `renv`, users iteratively install packages, then retroactively "snapshot" the current project status to generate a lockfile by calling `renv::snapshot`.

[The lockfile contains 3 main components](https://rstudio.github.io/renv/articles/renv.html#infrastructure):
* `Version` - The R version used in the project
* `Repositories` - A list of repositories where packages were installed from. This is generated by whatever repositories are set in `options("repos")`
* `Packages` - Contains information about each package used in the project, derived from the installed package's DESCRIPTION file, including its name, version, and data useful
to recreate the installation.

A `renv` snapshot is exactly what it sounds like, it "snapshots" the project status by inspecting the R version, set repositories, and installed packages. 
This sounds okay in theory, but in practice, these iterative, retroactive snapshots miss crucial information about how, when, and from where a package is installed.

## `rv`

`rv` takes a completely different approach than `renv`. Instead of iteratively installing packages and retroactively capturing the state, `rv` holistically installs the packages
you require in your library, ensuring the full dependency tree is resolvable before any package is installed. Even as you add new packages to your project, `rv` is ensuring each 
package is compatible with the library at each installation.

Additionally, because `rv` is handling installation and locking in one step, tracking of how, when, and from where packages are installed can be done more precisely, 
completely removing the risk of missing information.

## Examples

### Example 1 - Installing an incompatible version


### Example 2 - Repository Not Tracked

The retroactive snapshot can lead to packages not being found in repositories, in ways you don't expect. Below is an excerpt from a `renv.lock` file:

```
// renv.lock
{
  "R": {
    "Version": "4.4.1",
    "Repositories": [
      {
        "Name": "PPM",
        "URL": "https://packagemanager.posit.co/cran/2024-10-06"
      }
    ]
  },
  "Packages": {
    "R6": {
      "Package": "R6",
      "Version": "2.5.1",
      "Source": "Repository",
      "Repository": "PPM",
      "Requirements": [
        "R"
      ],
      "Hash": "470851b6d5d0ac559e9d01bb352b4021"
    },
    "glue": {
      "Package": "glue",
      "Version": "3.6.4",
      "Source": "Repository",
      "Repository": "https://cran.rstudio.com",
      "Requirements": [
        "R",
        "utils"
      ],
      "Hash": "47623f66b4e80b3b0587bc5d7b309888"
    }
  }
}
```

At first glance, this renv.lock file should be able to restore. `R6 2.5.1` should come from PPM (`https://packagemanager.posit.co/cran/2024-10-06`) and `glue 3.6.4` should come from `https://cran.rstudio.com`.
But when calling `renv::restore()` we see an interesting error:

```ansi
# Downloading packages ------------------------------------------
- Downloading glue from https://cran.rstudio.com ...    ERROR [error code 22]
[31mWarning: failed to find source for 'glue 3.6.4' in package repositories
Warning: error downloading 'https://packagemanager.posit.co/cran/2024-10-06/
src/contrib/Archive/glue/glue_3.6.4.tar.gz' [error code 22]
Error: failed to retrieve package 'glue@3.6.4'[0m
```

It appears, `glue`, despite it having *some* tracking information regarding its source, is not able to be found. It checks in the specified repository URL, checks the other repository, checks the archive of the other repository,
then fails to retrieve the package. This is a recoverable situation, but annoying and shows some of faults with `renv`'s retroactive source capture.

### Example 3 - Incorrect repository aliases

`renv` tracks the Repository source according to an alias when possible, as seen with `R6` in the example above. As mentioned in the [renv background](#renv), the package information is derived from the DESCRIPTION file, 
meaning the alias is also recorded there upon installation.

Multi-PPM
